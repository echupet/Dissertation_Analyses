TITLE:	DSEM testing for linear trend.

DATA:	FILE IS ../../Merged_Data/Merged_Data_Mplus_9s_n154_nameless_2024-06-18.csv;

VARIABLE:	NAMES ARE subid session BDI EF age_estimate days_since_base
	ps1 ps2 ps3 ps4 ps5 ps6 ps7 ps8
	ts1 ts2 ts3 ts4 ts5 ts6 ts7 ts8
	trx61 trx16 ts1_0b ts1_2b ps1_0b ps1_2b
	ts6_0b ts6_2b ps6_0b ps6_2b ts_1267 ts_3458 all_ps
	ts1_fix	ts6_fix
	age sex
	Acc Acc_0b Acc_2b Miss_0b Lure_0b Nlure_0b Target_0b
	bdi_z Acc0_z ps6_0b_z age_z sex_code;

	
	!CATEGORICAL ARE subid;
	! check centering

	MISSING ARE ALL (-999);
	
	USEVARIABLES ARE subid BDI days_since_base age sex;

	WITHIN = days_since_base;! Time is only used in the Within-Level model;
	CLUSTER = subid;!The Between-Level ID variable is SUB;
	BETWEEN = age sex;!Job Stress only in the Between-Model;
	Define: CENTER age (GRANDMEAN);!Person-mean center to time-varying covariate to get a within-person effect;

! probably want days instead of session variable...
ANALYSIS:
TYPE = TWOLEVEL RANDOM;!Two-Level Model with paths that are latent variables;
ESTIMATOR = BAYES;!Lagged variables can only be estimated with Bayes in Mplus; 
BITERATIONS = (1000);!Run at least 1000 iteration of the MCMC algorithm;

MODEL:
%WITHIN%
trend | BDI ON days_since_base;! BDI is regressed on time to capture the trend over time, the slope is latent;

%BETWEEN%
[BDI]; !mean intercept, gamma_00;
[trend]; !mean of the linear trend slope, gamma_30;

BDI; !intercept variance, tau_00;
trend; !linear trend slope variance, tau_33;

BDI on age sex;
trend on age sex;

OUTPUT:	STDYX;

!SAVEDATA: DIFFTEST IS Data/NAME.txt;

! Works.
